name: assets-manager
base: ubuntu@22.04
version: "0.1"
summary: Assets manager for the Canonical web team.
description: |
  Assets manager for the Canonical web team.
platforms:
  amd64:

extensions:
  - flask-framework

parts:
  flask-framework/install-app:
    after:
      - build-ui
    prime:
      - flask/app/app.py
      - flask/app/webapp
      - flask/app/templates
      - flask/app/static
      - flask/app/form-field-data.yaml

  build-ui:
    plugin: nil
    source: .
    source-type: local
    build-snaps:
      - node/22/stable
    override-build: |
      set -eux
      # avoid conflicts with local development
      rm -rf node_modules
      rm -rf charm
      # install dependencies
      npm install -g yarn
      yarn install
      # build the UI
      yarn run build

  runtime-debs:
    plugin: nil
    stage-packages:
      - bash
      - coreutils
      - ca-certificates
      - libsodium-dev
      # Wand dependencies
      - libmagic1
      - libmagickwand-dev
      # Pillow dependencies
      - libtiff5-dev
      - libjpeg8-dev
      - libopenjp2-7-dev
      - zlib1g-dev
      - libfreetype6-dev
      - liblcms2-dev
      - libwebp-dev
      - tcl8.6-dev
      - tk8.6-dev
      - python3-tk
      - libharfbuzz-dev
      - libfribidi-dev
      - libxcb1-dev
      # SH dependencies
      - libjpeg-progs
      - optipng
      # psycopg2 dependencies
      - libpq-dev
